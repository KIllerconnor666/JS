<!DOCTYPE html>
<html>
<head>
	<title></title>

	<link rel="stylesheet" type="text/css" href="superEstilo.css">
</head>
<body onkeypress="tecla(event)" name="cuerpo">
	<p id="puntos"></p>
	<p id ="vidas"></p>

	<input type='image' id='casilla0' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla1' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla2' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla3' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla4' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla5' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla6' src='suelo.jpg' width='70px' height='70px' draggable='false'>

	<br>

	<input type='image' id='casilla7' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla8' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla9' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla10' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla11' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla12' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla13' src='suelo.jpg' width='70px' height='70px' draggable='false'>

	<br>

	<input type='image' id='casilla14' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla15' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla16' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla17' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla18' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla19' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla20' src='suelo.jpg' width='70px' height='70px' draggable='false'>

	<br>

	<input type='image' id='casilla21' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla22' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla23' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla24' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla25' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla26' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla27' src='suelo.jpg' width='70px' height='70px' draggable='false'>

	<br>

	<input type='image' id='casilla28' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla29' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla30' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla31' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla32' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla33' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla34' src='suelo.jpg' width='70px' height='70px' draggable='false'>

	<br>

	<input type='image' id='casilla35' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla36' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla37' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla38' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla39' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla40' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla41' src='suelo.jpg' width='70px' height='70px' draggable='false'>

	<br>

	<input type='image' id='casilla42' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla43' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla44' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla45' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla46' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla47' src='suelo.jpg' width='70px' height='70px' draggable='false'>
	<input type='image' id='casilla48' src='suelo.jpg' width='70px' height='70px' draggable='false'>

	<script>

		var casillas = [[document.getElementById("casilla0"),document.getElementById("casilla1"),document.getElementById("casilla2"),document.getElementById("casilla3"),document.getElementById("casilla4"),document.getElementById("casilla5"),document.getElementById("casilla6")],
		[document.getElementById("casilla7"),document.getElementById("casilla8"),document.getElementById("casilla9"),document.getElementById("casilla10"),document.getElementById("casilla11"),document.getElementById("casilla12"),document.getElementById("casilla13")],
		[document.getElementById("casilla14"),document.getElementById("casilla15"),document.getElementById("casilla16"),document.getElementById("casilla17"),document.getElementById("casilla18"),document.getElementById("casilla19"),document.getElementById("casilla20")],
		[document.getElementById("casilla21"),document.getElementById("casilla22"),document.getElementById("casilla23"),document.getElementById("casilla24"),document.getElementById("casilla25"),document.getElementById("casilla26"),document.getElementById("casilla27")],
		[document.getElementById("casilla28"),document.getElementById("casilla29"),document.getElementById("casilla30"),document.getElementById("casilla31"),document.getElementById("casilla32"),document.getElementById("casilla33"),document.getElementById("casilla34")],
		[document.getElementById("casilla35"),document.getElementById("casilla36"),document.getElementById("casilla37"),document.getElementById("casilla38"),document.getElementById("casilla39"),document.getElementById("casilla40"),document.getElementById("casilla41")],
		[document.getElementById("casilla42"),document.getElementById("casilla43"),document.getElementById("casilla44"),document.getElementById("casilla45"),document.getElementById("casilla46"),document.getElementById("casilla47"),document.getElementById("casilla48")]];

		var prota

		var goblins = []

		var tiempo = 0

		function tecla(e){
			
			switch (window.event.keyCode) {
				//W
				case 119:
					if (prota.vivo) {
						prota.moverX(-1)
					}
					
					break

				//A
				case 97:
					if (prota.vivo) {
						prota.moverY(-1)
					}
					
					break

				//S
				case 115:
					if (prota.vivo) {
						prota.moverX(1)
					}
					
					break

				//D
				case 100:
					if (prota.vivo) {
						prota.moverY(1)
					}
					
					break

				//Espacio
				case 32:
					if (prota.vivo) {
						prota.pegar()
					}
					
					break
				
			}
		}

		function generarPersonajes(){

			prota = new Caballero()
			prota.crear()

			goblins = [new Goblin(),new Goblin(),new Goblin(),new Goblin(),new Goblin(), new Goblin()]

			for(i = 0; i<5; i++){

				goblins[i].crear()
			}

			loop()
			contarTiempo()
		}

		function contarTiempo(){

			tiempo++

			prota.comprobarSangre()

			mostrar()

			if (prota.vivo) {
				setTimeout("contarTiempo()", 1000)
			}	
		}

		function loop(){

			for(i = 0; i<goblins.length; i++){

				goblins[i].mover()

			}

			if (prota.vivo) {
				setTimeout("loop()", 1500)
			}
			
		}

		function Goblin(){

			this.x = Math.trunc(Math.random()*7)
			this.y = Math.trunc(Math.random()*7)
			this.vivo = true
		}

		Goblin.prototype.crear = function(){

			if (casillas[this.x][this.y].src.indexOf("suelo.jpg") != -1) {
				
				casillas[this.x][this.y].src = "goblin.jpg"

			}else {

				this.x = Math.trunc(Math.random()*7)
				this.y = Math.trunc(Math.random()*7)
				this.crear()
			}	
		}

		Goblin.prototype.mover = function(){

			if(this.vivo == true){

				randomX = randomIntFromInterval(-1, 1)
				randomY = randomIntFromInterval(-1, 1)

				while((this.x+randomX <= -1) || (this.x+randomX >= 7)){

					randomX = randomIntFromInterval(-1, 1)
				}

				while((this.y+randomY <= -1) || (this.y+randomY >= 7)){

					randomY = randomIntFromInterval(-1, 1)
				}

				for(k = 0; k<goblins.length; k++){

					if((prota.vidas > 0) && (this.x == prota.x) && (this.y == prota.y)){

						casillas[this.x][this.y].src = "caballero.jpg"
						break

					}if((goblins[k].vivo == false) && (this.x == goblins[k].x) && (this.y == goblins[k].y)){

						casillas[this.x][this.y].src = "sangre.jpg"
						break

					}else {

						casillas[this.x][this.y].src = "suelo.jpg"
					}
				}

				this.x = this.x+randomX
				this.y = this.y+randomY
				casillas[this.x][this.y].src = "goblin.jpg"

				this.pegar()
			}		
		}

		Goblin.prototype.pegar = function(){

			ostia = randomIntFromInterval(0, 1)

			if (ostia == 1) {
				
				for(i = this.x-1; i<=this.x+1; i++){

					for(j = this.y-1; j<=this.y+1;j++){

						if((prota.x == i) && (prota.y == j)){

							prota.vidas--

							if (prota.vidas <= 0) {
								prota.vivo = false
								casillas[prota.x][prota.y].src = "muerte.jpg"
							}
						}

					}
				}
			}
		}

		function Caballero(){

			this.x = Math.trunc(Math.random()*7)
			this.y = Math.trunc(Math.random()*7)
			this.vidas = 5
			this.puntos = 0
			this.sangre = 0
			this.vivo = true
		}

		Caballero.prototype.crear = function(){

			casillas[this.x][this.y].src = "caballero.jpg"
		}

		Caballero.prototype.moverX = function(z){

			if((this.x+z > -1) && (this.x+z < 7)){

				for(k = 0; k<goblins.length; k++){

					if((goblins[k].vivo == true) && (this.x == goblins[k].x) && (this.y == goblins[k].y)){

						casillas[this.x][this.y].src = "goblin.jpg"
						break

					}else {

						casillas[this.x][this.y].src = "suelo.jpg"
					}
				}

				this.x = this.x+z

				if (casillas[this.x][this.y].src.indexOf("sangre.jpg") != -1) {
					this.sangre++
				}

				casillas[this.x][this.y].src = "caballero.jpg"
			}		
		}

		Caballero.prototype.moverY = function(z){

			if((this.y+z > -1) && (this.y+z < 7)){

				for(k = 0; k<goblins.length; k++){

					if((goblins[k].vivo == true) && (this.x == goblins[k].x) && (this.y == goblins[k].y)){

						casillas[this.x][this.y].src = "goblin.jpg"
						break

					}else {

						casillas[this.x][this.y].src = "suelo.jpg"
					}
				}
				
				this.y = this.y+z

				if (casillas[this.x][this.y].src.indexOf("sangre.jpg") != -1) {
					this.sangre++
				}

				casillas[this.x][this.y].src = "caballero.jpg"
			}	
		}

		Caballero.prototype.pegar = function(){

			for(i = this.x-1; i<=this.x+1; i++){

				for(j = this.y-1; j<=this.y+1;j++){

					for(k = 0; k<goblins.length; k++){

						if((goblins[k].x == i) && (goblins[k].y == j)){

							if(goblins[k].vivo){

								prota.puntos++
							}

							goblins[k].vivo = false

							if((this.x != goblins[k].x) || (this.y != goblins[k].y)){

								casillas[i][j].src = "sangre.jpg"
							}
							
							goblins[k] = new Goblin()
							goblins[k].crear()

						}
					}

				}
			}
		}

		Caballero.prototype.comprobarSangre = function(){

			if(this.sangre >= 10){

				this.sangre = this.sangre -10
				this.vidas++
			}
		}

		function mostrar(){

			puntos = document.getElementById("puntos")
			vida = document.getElementById("vidas")

			puntos.innerHTML = "Puntos: "+prota.puntos+" <-><-> Vidas: "+prota.vidas+" <-><-> Sangre: "+prota.sangre
			vida.innerHTML = "<-><-><->Tiempo total: "+tiempo+"<-><-><->"
		}

		function randomIntFromInterval(min,max){
		    return Math.floor(Math.random()*(max-min+1)+min);
		}

		//Comienza la ejecución
		generarPersonajes()

	</script>

</body>
</html>